<!DOCTYPE html>
<html lang="en">
<head>
  <title>OWL-NEO4J Query Engine</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!--<link rel="stylesheet" href="css/bootstrap.min.css">
  <script src="js/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script> -->
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <style>
    .hidden{
      display: none;
    }
    .visible{
      display: block;
    }
    .topspacer{
      margin-top: 10px;
    }
    .leftspacer{
      margin-left: 10px;
    }
    .rightspacer{
      margin-right: 10px;
    }
    .gi-2x{
      font-size: 2em;
    }
    input[type="file"] {
    display: none;
	}
	.custom-file-upload {
	    display: inline-block;
	    cursor: pointer;
	}
  </style>
</head>
<body>

<div class="container">
  <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12">
      <div class="topspacer">&nbsp;</div>
      <div class="panel panel-default">
        <div class="panel-body">
          <p class="text-center bg-info" style="padding:10px;"><b>Query Generation Engine</b></p>
          <div id="error" class="alert alert-danger hidden" role="alert"><strong>Error!!</strong> <span class="message"></span></div>
          <div id="success" class="alert alert-success hidden" role="alert"><strong>Success!!</strong> <span class="message"></span></div>
          <div class="form-inline" id="object">
            <div class="form-group col-lg-12">
              	<p class="bg-success" style="padding:10px;"><b>Upload OWL-XML	</b></p>
              	<input type="text" class="form-control" style="width:500px;" id="owlfilepath" disabled="true">
              	<label for="file-upload" class="custom-file-upload btn btn-primary">
				    <i class="glyphicon glyphicon-folder-open rightspacer"></i> Browse OWL-XML file
				</label>
				<input id="file-upload" type="file"/>
				<button type="button" class="btn btn-primary" id="uploadowlfile"><span class="glyphicon glyphicon-upload rightspacer" aria-hidden="true"></span><b>Import</b></button>
				<div class="topspacer">&nbsp;</div>
            </div>
          </div>
          <div class="form-inline" id="object">
            <div class="form-group col-lg-12">
              <p class="bg-success" style="padding:10px;"><b>Select Clause</b></p>
            </div>
          </div>
          <div class="row">
            <div class=" col-md-5 col-md-offset-1">
              <div class="panel panel-default">
                <div class="panel-body">
                  <div class="form-inline" id="object">
                    <div class="form-group">
                      <label>Subject's data property</label> <br/>
                      <input type="text" class="form-control" id="subjectdataproperty" placeholder="value">
                      <button type="button" class="btn btn-primary" id="addsubjectdataproperty"><span class="glyphicon glyphicon-plus rightspacer" aria-hidden="true"></span>Add</button>
                      <button type="button" class="btn btn-primary" id="updatesubjectdataproperty"><span class="glyphicon glyphicon-ok rightspacer" aria-hidden="true"></span>update</button>
                      <button type="button" class="btn btn-primary" id="cancelsubjectdataproperty"><span class="glyphicon glyphicon-minus rightspacer" aria-hidden="true"></span>cancel</button>
                      <br/>
                      <div class="topspacer">&nbsp;</div>
                      <button id="editsubjectdataproperty" type="button" class="btn btn-info"><span class="glyphicon glyphicon-pencil rightspacer" aria-hidden="true"></span>Edit</button>
                      <button id="deletesubjectdataproperty" type="button" class="btn btn-danger"><span class="glyphicon glyphicon-remove rightspacer" aria-hidden="true"></span>Delete</button>
                      <div class="topspacer">&nbsp;</div>
                    </div>
                  </div>
                  
                  <ul class="list-group" id="selectsubjectlist">
                    
                  </ul>
                  <div class="topspacer">&nbsp;</div>
                </div>
              </div>
            </div>
            <div class=" col-md-5">
              <div class="panel panel-default">
                <div class="panel-body">
                  <div class="form-inline" id="object">
                    <div class="form-group">
                      <label>Object's data property</label> <br/>
                      <input type="text" class="form-control" id="objectdataproperty" placeholder="value">
                      <button type="button" class="btn btn-primary" id="addobjectdataproperty"><span class="glyphicon glyphicon-plus rightspacer" aria-hidden="true"></span>Add</button>
                      <button type="button" class="btn btn-primary" id="updateobjectdataproperty"><span class="glyphicon glyphicon-ok rightspacer" aria-hidden="true"></span>update</button>
                      <button type="button" class="btn btn-primary" id="cancelobjectdataproperty"><span class="glyphicon glyphicon-minus rightspacer" aria-hidden="true"></span>cancel</button>
                      <br/>
                      <div class="topspacer">&nbsp;</div>
                      <button id="editobjectdataproperty" type="button" class="btn btn-info"><span class="glyphicon glyphicon-pencil rightspacer" aria-hidden="true"></span>Edit</button>
                      <button id="deleteobjectdataproperty" type="button" class="btn btn-danger"><span class="glyphicon glyphicon-remove rightspacer" aria-hidden="true"></span>Delete</button>
                      <div class="topspacer">&nbsp;</div>
                    </div>
                  </div>
                  <ul class="list-group" id="selectobjectlist">
                    
                  </ul>
                  <div class="topspacer">&nbsp;</div>
                </div>
              </div>
            </div>
          </div>
          <div class="form-inline" id="subject">
            <div class="form-group col-lg-12">
              <p class="bg-success" style="padding:10px;"><b>Where Clause</b></p>
              <label>Subject &nbsp;&nbsp;&nbsp;&nbsp;</label> 
              <select class="form-control" id="subcondition">
                <option value="and" selected="selected">AND</option>
                <option value="or">OR</option>
              </select>
              <select class="form-control" id="subopenparenthesis">
                <option value="blank" selected="selected"></option>
                <option value="openingparenthesis1">&#40;</option>
                <option value="openingparenthesis2">&#40;&#40;</option>
                <option value="openingparenthesis3">&#40;&#40;&#40;</option>
                <option value="openingparenthesis4">&#40;&#40;&#40;&#40;</option>
                <option value="openingparenthesis5">&#40;&#40;&#40;&#40;&#40;</option>
                <option value="openingparenthesis6">&#40;&#40;&#40;&#40;&#40;&#40;</option>
              </select>
              <select class="form-control" id="subpropertytype">
                <option value="classiri" selected="selected">Class-IRI</option>
                <option value="datapropertyiri">Data property-IRI</option>
              </select>
              <input type="text" class="form-control hidden" id="subdatapropertyiri" placeholder="Data property-IRI">
              <select class="form-control" id="suboperator">
                <option value="equalto" selected="selected">&#61;</option>
                <option value="notequalto">&#33;&#61;</option>
                <option value="lessthan">&lt;</option>
                <option value="greaterthan">&gt;</option>
                <option value="lessthanequalto">&lt;&#61;</option>
                <option value="greaterthanequalto">&gt;&#61;</option>
                
              </select>
              <input type="text" class="form-control" id="subtxtvalue" placeholder="value">
              <select class="form-control" id="subcloseparenthesis">
                <option value="blank" selected="selected"></option>
                <option value="closingparenthesis1">&#41;</option>
                <option value="closingparenthesis2">&#41;&#41;</option>
                <option value="closingparenthesis3">&#41;&#41;&#41;</option>
                <option value="closingparenthesis4">&#41;&#41;&#41;&#41;</option>
                <option value="closingparenthesis5">&#41;&#41;&#41;&#41;&#41;</option>
                <option value="closingparenthesis6">&#41;&#41;&#41;&#41;&#41;&#41;</option>
              </select>
              <button type="button" class="btn btn-primary" id="addsubjectcriteria"><span class="glyphicon glyphicon-plus rightspacer" aria-hidden="true"></span>Add</button>
              <button type="button" class="btn btn-primary" id="updatesubjectcriteria"><span class="glyphicon glyphicon-ok rightspacer" aria-hidden="true"></span>update</button>
              <button type="button" class="btn btn-primary" id="cancelsubjectcriteria"><span class="glyphicon glyphicon-minus rightspacer" aria-hidden="true"></span>cancel</button>
              <div class="topspacer">&nbsp;</div>
            </div>
          </div>
          
          <div class="panel panel-default col-md-10 col-md-offset-1">
            <div class="panel-body">
              <button id="subbtnedit" type="button" class="btn btn-info"><span class="glyphicon glyphicon-pencil rightspacer" aria-hidden="true"></span>Edit</button>
              <button id="subbtndelete" type="button" class="btn btn-danger"><span class="glyphicon glyphicon-remove rightspacer" aria-hidden="true"></span>Delete</button>
              <div class="topspacer">&nbsp;</div>
              <div class="row">
                <div class="list-group col-md-10" id="subject-list-group"></div>
                <div class="list-group col-md-6 hidden" id="neosubject-list-group"></div>
              </div>
            </div>
          </div>
          <div class="form-inline" id="predicate">
            <div class="form-group col-lg-12">
              <label>Predicate &nbsp;</label> 
              <input type="text" class="form-control" id="preobjectpropertyiri" placeholder="Object Property IRI">
              <div class="topspacer">&nbsp;</div>
            </div>
          </div>
          
          <div class="form-inline" id="object">
            <div class="form-group col-lg-12">
              <label>Object &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label> 
              <select class="form-control" id="objcondition">
                <option value="and" selected="selected">AND</option>
                <option value="or">OR</option>
              </select>
              <select class="form-control" id="objopenparenthesis">
                <option value="blank" selected="selected"></option>
                <option value="openingparenthesis1">&#40;</option>
                <option value="openingparenthesis2">&#40;&#40;</option>
                <option value="openingparenthesis3">&#40;&#40;&#40;</option>
                <option value="openingparenthesis4">&#40;&#40;&#40;&#40;</option>
                <option value="openingparenthesis5">&#40;&#40;&#40;&#40;&#40;</option>
                <option value="openingparenthesis6">&#40;&#40;&#40;&#40;&#40;&#40;</option>
              </select>
              <select class="form-control" id="objpropertytype">
                <option value="classiri" selected="selected">Class-IRI</option>
                <option value="datapropertyiri">Data property-IRI</option>
              </select>
              <input type="text" class="form-control hidden" id="objdatapropertyiri" placeholder="Data property-IRI">
              <select class="form-control" id="objoperator">
                <option value="equalto" selected="selected">&#61;</option>
                <option value="notequalto">&#33;&#61;</option>
                <option value="lessthan">&lt;</option>
                <option value="greaterthan">&gt;</option>
                <option value="lessthanequalto">&lt;&#61;</option>
                <option value="greaterthanequalto">&gt;&#61;</option>
                
              </select>
              <input type="text" class="form-control" id="objtxtvalue" placeholder="value">
              <select class="form-control" id="objcloseparenthesis">
                <option value="blank" selected="selected"></option>
                <option value="closingparenthesis1">&#41;</option>
                <option value="closingparenthesis2">&#41;&#41;</option>
                <option value="closingparenthesis3">&#41;&#41;&#41;</option>
                <option value="closingparenthesis4">&#41;&#41;&#41;&#41;</option>
                <option value="closingparenthesis5">&#41;&#41;&#41;&#41;&#41;</option>
                <option value="closingparenthesis6">&#41;&#41;&#41;&#41;&#41;&#41;</option>
              </select>
              <button type="button" class="btn btn-primary" id="addobjectcriteria"><span class="glyphicon glyphicon-plus rightspacer" aria-hidden="true"></span>Add</button>
              <button type="button" class="btn btn-primary" id="updateobjectcriteria"><span class="glyphicon glyphicon-ok rightspacer" aria-hidden="true"></span>update</button>
              <button type="button" class="btn btn-primary" id="cancelobjectcriteria"><span class="glyphicon glyphicon-minus rightspacer" aria-hidden="true"></span>cancel</button>
              <div class="topspacer">&nbsp;</div>
            </div>
          </div>
          
          <div class="panel panel-default col-md-10 col-md-offset-1">
            <div class="panel-body">
              <button id="objbtnedit" type="button" class="btn btn-info"><span class="glyphicon glyphicon-pencil rightspacer" aria-hidden="true"></span>Edit</button>
              <button id="objbtndelete" type="button" class="btn btn-danger"><span class="glyphicon glyphicon-remove rightspacer" aria-hidden="true"></span>Delete</button>
              <div class="topspacer">&nbsp;</div>
              <div class="row">
                <div class="list-group col-md-10" id="object-list-group"></div>
                <div class="list-group col-md-6 hidden" id="neoobject-list-group"></div>
              </div>
            </div>
          </div>
          
          <div class="form-inline" id="executequery">
            <div class="form-group col-lg-12">
                <button type="button" id="btnexecutequery" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon glyphicon-play rightspacer" aria-hidden="true"></span><b>Execute Query</b></button>
            </div>
          </div>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-body">
          <p class="text-center bg-info" style="padding:10px;"><b>Result of the query</b></p>
          <table class="table table-striped" id="tblresult"> 
            
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
// GENERIC FLAGS
var subIsNotA = 0;
var obIsNotA = 0;

  $( document ).ready(function() {
	  
    // GENERIC FUNCTIONS
    function closeAlert(){
      window.setTimeout(function () {
        $("#error").fadeOut(1000);
      }, 5000);
      window.setTimeout(function () {
        $("#error").removeClass('visible');
        $("#error").addClass('hidden');
      }, 7000);
    } 
    function showError(errormessage){
      $('#error > .message').html(errormessage);
        if ($("#error").hasClass("hidden")) 
        {
          $("#error").fadeIn(1000);
          $('#error').removeClass('hidden');
          $('#error').addClass('visible');
          closeAlert();
        }
        $('body, html').animate({scrollTop: 0});
    }
    function closeSuccess(){
        window.setTimeout(function () {
          $("#success").fadeOut(1000);
        }, 5000);
        window.setTimeout(function () {
          $("#success").removeClass('visible');
          $("#success").addClass('hidden');
        }, 7000);
      } 
      function showSuccess(errormessage){
        $('#success > .message').html(errormessage);
          if ($("#success").hasClass("hidden")) 
          {
            $("#success").fadeIn(1000);
            $('#success').removeClass('hidden');
            $('#success').addClass('visible');
            closeSuccess();
          }
          $('body, html').animate({scrollTop: 0});
      }
    function getEncodedValue(a)
    {
      switch(a)
      {
        case '(': a = '&#40;'; break;
        case ')': a = '&#41;'; break;
        case '=': a = '&#61;'; break;
        case '<': a = '&lt;'; break;
        case '>': a = '&gt;'; break;
        case '<=': a = '&lt;&#61;'; break;
        case '>=': a = '&gt;&#61;'; break;
        case '!=': a = '&#33;&#61;'; break;
      }
      return a;
    }

    // SUBJECT 

    $('#updatesubjectcriteria').hide();
    $('#cancelsubjectcriteria').hide();
    
    $("#subpropertytype").change(function () {
        var v = this.value;
        if(v === 'datapropertyiri')
        {
          $("#subdatapropertyiri").removeClass('hidden');
          $("#subdatapropertyiri").addClass('visible');
        }
        else
        {
          if ($("#subdatapropertyiri").hasClass("visible")) 
          {
            $("#subdatapropertyiri").removeClass('visible');
            $("#subdatapropertyiri").addClass('hidden');
          }
        }
    });
    
    function validateSubjectBeforeAddUpdate()
    {
      var subdatapropertyiri = $.trim($('#subdatapropertyiri').val());
      var subtxtvalue = $.trim($('#subtxtvalue').val());
      var errormessage='';

      if ($('#subdatapropertyiri').hasClass("visible") && subdatapropertyiri === '') 
      {
        errormessage = errormessage + ' ' + 'Data property IRI should not be empty.' + ' ';
      }
      if(subtxtvalue === '')
      {
        errormessage = errormessage + ' ' + 'Value should not be empty.' + ' ';
      }
      return errormessage;
    }
    function getSubjectRow()
    {
      var subcondition_value = $("#subcondition").val();
      var subcondition_text = $("#subcondition option:selected").text();

      var subopenparenthesis_value = $("#subopenparenthesis").val();
      var subopenparenthesis_text = getEncodedValue($("#subopenparenthesis option:selected").text());

      var subpropertytype_value = $("#subpropertytype").val();
      var subpropertytype_text = $("#subpropertytype option:selected").text();

      var subdatapropertyiri_text = $("#subdatapropertyiri").val();

      var suboperator_value = $("#suboperator").val();
      var suboperator_text = getEncodedValue($("#suboperator option:selected").text());

      var subtxtvalue_text = $("#subtxtvalue").val();

      var subcloseparenthesis_value = $("#subcloseparenthesis").val();
      var subcloseparenthesis_text = getEncodedValue($("#subcloseparenthesis option:selected").text());

      var newRule = '<a  class="list-group-item"><p><span data-elementtype="select" data-elementid="subcondition" data-value="'+subcondition_value+'">'+subcondition_text+'</span> <span data-elementtype="select" data-elementid="subopenparenthesis" data-value="'+subopenparenthesis_value+'">'+subopenparenthesis_text+'</span> <span data-elementtype="select" data-elementid="subpropertytype" data-value="'+subpropertytype_value+'">'+subpropertytype_text+'</span>';

      if(subpropertytype_value === 'classiri' && suboperator_value === 'notequalto')
   	  {
   	  	subIsNotA ++;
   	  }
      if(subpropertytype_value === 'datapropertyiri')
      {
        newRule = newRule + ' : <span data-elementtype="text" data-elementid ="subdatapropertyiri">'+subdatapropertyiri_text+'</span>';
      }

      newRule = newRule + ' <span data-elementtype="select" data-elementid="suboperator" data-value="'+suboperator_value+'">'+suboperator_text+'</span> \'<span data-elementtype="text" data-elementid ="subtxtvalue">'+subtxtvalue_text+'</span>\' <span data-elementtype="select" data-elementid="subcloseparenthesis" data-value="'+subcloseparenthesis_value+'">'+subcloseparenthesis_text+'</span></p></a>';

      return newRule;
    }
    function getNeoSubjectRow()
    {
      var subcondition_value = $("#subcondition").val();
      var subcondition_text = $("#subcondition option:selected").text();

      var subopenparenthesis_value = $("#subopenparenthesis").val();
      var subopenparenthesis_text = getEncodedValue($("#subopenparenthesis option:selected").text());

      var subpropertytype_value = $("#subpropertytype").val();
      var subpropertytype_text = $("#subpropertytype option:selected").text();

      var subdatapropertyiri_text = $("#subdatapropertyiri").val();

      var suboperator_value = $("#suboperator").val();
      var suboperator_text = getEncodedValue($("#suboperator option:selected").text());

      var subtxtvalue_text = $("#subtxtvalue").val();

      var subcloseparenthesis_value = $("#subcloseparenthesis").val();
      var subcloseparenthesis_text = getEncodedValue($("#subcloseparenthesis option:selected").text());

      if(subpropertytype_value === 'classiri')
      {
    	  if(suboperator_value === 'notequalto')
   		  {
    		  var newRule = '<a  class="list-group-item"><p>'+subcondition_text+' '+subopenparenthesis_text+'(ncs.type="Class" and (ncs.IRI="'+subtxtvalue_text+'"))'+subcloseparenthesis_text+'';
   		  }
    	  else
   		  {
    		  var newRule = '<a  class="list-group-item"><p>'+subcondition_text+' '+subopenparenthesis_text+'(cs.type="Class" and (cs.IRI'+suboperator_text+'"'+subtxtvalue_text+'"))'+subcloseparenthesis_text+'';
   		  }
      }
      else if(subpropertytype_value === 'datapropertyiri')
      {
        var newRule = '<a  class="list-group-item"><p>'+subcondition_text+' '+subopenparenthesis_text+'(s.type="NamedIndividual" and s.'+subdatapropertyiri_text+''+suboperator_text+'"'+subtxtvalue_text+'")'+subcloseparenthesis_text+'';
      }
      
      return newRule;
    }
    function resetSubjectRow()
    {
      $("#subdatapropertyiri").val('');
      $("#subtxtvalue").val('');
    }
    $('#addsubjectcriteria').click(function() {

      var errormessage = validateSubjectBeforeAddUpdate();
      if(errormessage === '')
      {
        // Validation DONE
        var newRule = getSubjectRow();

        $("#subject-list-group").append(newRule);

        $('#subject-list-group > a').last().click(function() {
          if ($(this).hasClass("active")) 
              {
                $(this).removeClass('active');
              }
              else
              {
                $('#subject-list-group > a').removeClass('active');
                $(this).addClass('active');
              }
        });
        $("#neosubject-list-group").append(getNeoSubjectRow());
        resetSubjectRow();
      }
      else
      {
        // Error Exists
        showError(errormessage);
      }
    });
    $('#updatesubjectcriteria').click(function() {
      var errormessage = validateSubjectBeforeAddUpdate();
      if(errormessage === '')
      {
        // Validation DONE
        
        var listItem = $('#subject-list-group > a.active');
        var index = $( "#subject-list-group > a" ).index( listItem );
        if($('#subject-list-group > a.active > p > span[data-value="notequalto"]').length > 0)
       	{
       		subIsNotA --;
       	}
        var newRule = getSubjectRow();
        
        
        $('#subject-list-group > a.active').replaceWith(newRule);
        $('#subject-list-group > a').eq(index).click(function() {
          if ($(this).hasClass("active")) 
              {
                $(this).removeClass('active');
              }
              else
              {
                $('#subject-list-group > a').removeClass('active');
                $(this).addClass('active');
              }
        });

        $("#neosubject-list-group > a").eq(index).replaceWith(getNeoSubjectRow());

        $('#updatesubjectcriteria').hide();
        $('#cancelsubjectcriteria').hide();
        $('#addsubjectcriteria').show();
        resetSubjectRow();
      }
      else
      {
        // Error Exists
        showError(errormessage);
      }

    });
    $('#cancelsubjectcriteria').click(function() {
      $('#updatesubjectcriteria').hide();
      $('#cancelsubjectcriteria').hide();
      $('#addsubjectcriteria').show();
      resetSubjectRow();
      $('#subject-list-group > a.active').trigger('click');
    });
    $('#subbtnedit').click(function() {
      var errormessage = ' Please select some item to edit.';
      if($('#subject-list-group > a.active').length) 
      {
        $('#subject-list-group > a.active > p > span').each(function( index ) {
          switch($(this).attr('data-elementid'))
          {
            case 'subcondition': $("#subcondition").val($(this).attr('data-value')); break;
            case 'subopenparenthesis': $("#subopenparenthesis").val($(this).attr('data-value')); break;
            case 'subpropertytype': $("#subpropertytype").val($(this).attr('data-value')); $( "#subpropertytype" ).trigger( "change" ); break;
            case 'subdatapropertyiri': $("#subdatapropertyiri").val($(this).text()); break;
            case 'suboperator': $("#suboperator").val($(this).attr('data-value'));  break;
            case 'subtxtvalue': $("#subtxtvalue").val($(this).text()); break;
            case 'subcloseparenthesis': $("#subcloseparenthesis").val($(this).attr('data-value'));  break;
          }
        });
        $('#updatesubjectcriteria').show();
        $('#cancelsubjectcriteria').show();
        $('#addsubjectcriteria').hide();
      }
      else
      {
        showError(errormessage);
      }
    });  
    $('#subbtndelete').click(function() {
      var errormessage = ' Please select some item to delete.';
      if($('#subject-list-group > a.active').length) 
      {
        var listItem = $('#subject-list-group > a.active');
        var index = $( "#subject-list-group > a" ).index( listItem );
        if($('#subject-list-group > a.active > p > span[data-value="notequalto"]').length > 0)
       	{
       		subIsNotA --;
       	}
        $('#subject-list-group > a.active').remove();
        $("#neosubject-list-group > a").eq(index).remove();
      }
      else
      {
        showError(errormessage);
      }
    }); 
    

    // OBJECT 

    $('#updateobjectcriteria').hide();
    $('#cancelobjectcriteria').hide();

    $("#objpropertytype").change(function () {
        var v = this.value;
        if(v === 'datapropertyiri')
        {
          $("#objdatapropertyiri").removeClass('hidden');
          $("#objdatapropertyiri").addClass('visible');
        }
        else
        {
          if ($("#objdatapropertyiri").hasClass("visible")) 
          {
            $("#objdatapropertyiri").removeClass('visible');
            $("#objdatapropertyiri").addClass('hidden');
          }
        }
    });
    function validateObjectBeforeAddUpdate()
    {
      var objdatapropertyiri = $.trim($('#objdatapropertyiri').val());
      var objtxtvalue = $.trim($('#objtxtvalue').val());
      var errormessage='';

      if ($('#objdatapropertyiri').hasClass("visible") && objdatapropertyiri === '') 
      {
        errormessage = errormessage + ' ' + 'Data property IRI should not be empty.' + ' ';
      }
      if(objtxtvalue === '')
      {
        errormessage = errormessage + ' ' + 'Value should not be empty.' + ' ';
      }
      return errormessage;
    }
    function getObjectRow()
    {
      var objcondition_value = $("#objcondition").val();
      var objcondition_text = $("#objcondition option:selected").text();

      var objopenparenthesis_value = $("#objopenparenthesis").val();
      var objopenparenthesis_text = getEncodedValue($("#objopenparenthesis option:selected").text());

      var objpropertytype_value = $("#objpropertytype").val();
      var objpropertytype_text = $("#objpropertytype option:selected").text();

      var objdatapropertyiri_text = $("#objdatapropertyiri").val();

      var objoperator_value = $("#objoperator").val();
      var objoperator_text = getEncodedValue($("#objoperator option:selected").text());

      var objtxtvalue_text = $("#objtxtvalue").val();

      var objcloseparenthesis_value = $("#objcloseparenthesis").val();
      var objcloseparenthesis_text = getEncodedValue($("#objcloseparenthesis option:selected").text());

      var newRule = '<a  class="list-group-item"><p><span data-elementtype="select" data-elementid="objcondition" data-value="'+objcondition_value+'">'+objcondition_text+'</span> <span data-elementtype="select" data-elementid="objopenparenthesis" data-value="'+objopenparenthesis_value+'">'+objopenparenthesis_text+'</span> <span data-elementtype="select" data-elementid="objpropertytype" data-value="'+objpropertytype_value+'">'+objpropertytype_text+'</span>';

      if(objpropertytype_value === 'classiri' && objoperator_value === 'notequalto')
   	  {
   	  	obIsNotA ++;
   	  }
      if(objpropertytype_value === 'datapropertyiri')
      {
        newRule = newRule + ' : <span data-elementtype="text" data-elementid ="objdatapropertyiri">'+objdatapropertyiri_text+'</span>';
      }

      newRule = newRule + ' <span data-elementtype="select" data-elementid="objoperator" data-value="'+objoperator_value+'">'+objoperator_text+'</span> \'<span data-elementtype="text" data-elementid ="objtxtvalue">'+objtxtvalue_text+'</span>\' <span data-elementtype="select" data-elementid="objcloseparenthesis" data-value="'+objcloseparenthesis_value+'">'+objcloseparenthesis_text+'</span></p></a>';

      return newRule;
    }
    function getNeoObjectRow()
    {
      var objcondition_value = $("#objcondition").val();
      var objcondition_text = $("#objcondition option:selected").text();

      var objopenparenthesis_value = $("#objopenparenthesis").val();
      var objopenparenthesis_text = getEncodedValue($("#objopenparenthesis option:selected").text());

      var objpropertytype_value = $("#objpropertytype").val();
      var objpropertytype_text = $("#objpropertytype option:selected").text();

      var objdatapropertyiri_text = $("#objdatapropertyiri").val();

      var objoperator_value = $("#objoperator").val();
      var objoperator_text = getEncodedValue($("#objoperator option:selected").text());

      var objtxtvalue_text = $("#objtxtvalue").val();

      var objcloseparenthesis_value = $("#objcloseparenthesis").val();
      var objcloseparenthesis_text = getEncodedValue($("#objcloseparenthesis option:selected").text());

      if(objpropertytype_value === 'classiri')
      {
    	  if(objoperator_value === 'notequalto')
   		  {
    		  var newRule = '<a  class="list-group-item"><p>'+objcondition_text+' '+objopenparenthesis_text+'(nco.type="Class" and (nco.IRI="'+objtxtvalue_text+'"))'+objcloseparenthesis_text+'';
   		  }
    	  else
   		  {
    		  var newRule = '<a  class="list-group-item"><p>'+objcondition_text+' '+objopenparenthesis_text+'(co.type="Class" and (co.IRI'+objoperator_text+'"'+objtxtvalue_text+'"))'+objcloseparenthesis_text+'';
   		  }
        
      }
      else if(objpropertytype_value === 'datapropertyiri')
      {
        var newRule = '<a  class="list-group-item"><p>'+objcondition_text+' '+objopenparenthesis_text+'(o.type="NamedIndividual" and o.'+objdatapropertyiri_text+''+objoperator_text+'"'+objtxtvalue_text+'")'+objcloseparenthesis_text+'';
      }
      
      return newRule;
    }
    function resetObjectRow()
    {
      $("#objdatapropertyiri").val('');
      $("#objtxtvalue").val('');
    }
    $('#addobjectcriteria').click(function() {

      var errormessage = validateObjectBeforeAddUpdate();
      if(errormessage === '')
      {
        // Validation DONE
        var newRule = getObjectRow();
        $("#object-list-group").append(newRule);
        $('#object-list-group > a').last().click(function() {
          if ($(this).hasClass("active")) 
              {
                $(this).removeClass('active');
              }
              else
              {
                $('#object-list-group > a').removeClass('active');
                $(this).addClass('active');
              }
        });
        $("#neoobject-list-group").append(getNeoObjectRow());
        resetObjectRow();
      }
      else
      {
        // Error Exists
        showError(errormessage);
      }
    });
    $('#updateobjectcriteria').click(function() {
      var errormessage = validateObjectBeforeAddUpdate();
      if(errormessage === '')
      {
        // Validation DONE
        var listItem = $('#object-list-group > a.active');
        var index = $( "#object-list-group > a" ).index( listItem );
        if($('#object-list-group > a.active > p > span[data-value="notequalto"]').length > 0)
       	{
       		obIsNotA --;
       	}
        var newRule = getObjectRow();
        
        
        $('#object-list-group > a.active').replaceWith(newRule);
        $('#object-list-group > a').eq(index).click(function() {
          if ($(this).hasClass("active")) 
              {
                $(this).removeClass('active');
              }
              else
              {
                $('#object-list-group > a').removeClass('active');
                $(this).addClass('active');
              }
        });
        $("#neoobject-list-group > a").eq(index).replaceWith(getNeoObjectRow());

        $('#updateobjectcriteria').hide();
        $('#cancelobjectcriteria').hide();
        $('#addobjectcriteria').show();
        resetObjectRow();
      }
      else
      {
        // Error Exists
        showError(errormessage);
      }

    });
    $('#cancelobjectcriteria').click(function() {
      $('#updateobjectcriteria').hide();
      $('#cancelobjectcriteria').hide();
      $('#addobjectcriteria').show();
      resetObjectRow();
      $('#object-list-group > a.active').trigger('click');
    });
    $('#objbtnedit').click(function() {
      var errormessage = ' Please select some item to edit.';
      if($('#object-list-group > a.active').length) 
      {
        $('#object-list-group > a.active > p > span').each(function( index ) {
          switch($(this).attr('data-elementid'))
          {
            case 'objcondition': $("#objcondition").val($(this).attr('data-value')); break;
            case 'objopenparenthesis': $("#objopenparenthesis").val($(this).attr('data-value')); break;
            case 'objpropertytype': $("#objpropertytype").val($(this).attr('data-value')); $( "#objpropertytype" ).trigger( "change" ); break;
            case 'objdatapropertyiri': $("#objdatapropertyiri").val($(this).text()); break;
            case 'objoperator': $("#objoperator").val($(this).attr('data-value'));  break;
            case 'objtxtvalue': $("#objtxtvalue").val($(this).text()); break;
            case 'objcloseparenthesis': $("#objcloseparenthesis").val($(this).attr('data-value'));  break;
          }
        });
        $('#updateobjectcriteria').show();
        $('#cancelobjectcriteria').show();
        $('#addobjectcriteria').hide();
      }
      else
      {
        showError(errormessage);
      }
    });  
    $('#objbtndelete').click(function() {
      var errormessage = ' Please select some item to delete.';
      if($('#object-list-group > a.active').length) 
      {
        var listItem = $('#object-list-group > a.active');
        var index = $( "#object-list-group > a" ).index( listItem );
        if($('#object-list-group > a.active > p > span[data-value="notequalto"]').length > 0)
       	{
       		obIsNotA --;
       	}
        $('#object-list-group > a.active').remove();
        $("#neoobject-list-group > a").eq(index).remove();
      }
      else
      {
        showError(errormessage);
      }
    }); 
    
    
    // SELECT SUBJECT
    function resetSelectSubject()
    {
      $('#updatesubjectdataproperty').hide(); 
      $('#cancelsubjectdataproperty').hide(); 
      $('#addsubjectdataproperty').show(); 
      $('#selectsubjectlist > li.active').removeClass('active');
      $('#subjectdataproperty').val('');
    }
    $('#addsubjectdataproperty').click(function() {
      var errormessage = ' Please enter some data property for subject.';
      var txtvalue = $.trim($('#subjectdataproperty').val());
      if(txtvalue != '') 
      {
        $('#selectsubjectlist').append('<li class="list-group-item">'+txtvalue+'</li>');
        $('#selectsubjectlist > li').last().click(function() {
          if ($(this).hasClass("active")) 
          {
            $(this).removeClass('active');
          }
          else
          {
            $('#selectsubjectlist > li').removeClass('active');
            $(this).addClass('active');
          }
        });
        $('#subjectdataproperty').val('');
      }
      else
      {
        showError(errormessage);
      }
    }); 

    $('#updatesubjectdataproperty').hide(); 
    $('#cancelsubjectdataproperty').hide(); 

    $('#deletesubjectdataproperty').click(function() {
      var errormessage = ' Please select some subject data property to delete.';
      if($('#selectsubjectlist > li.active').length) 
      {
        $('#selectsubjectlist > li.active').remove();
      }
      else
      {
        showError(errormessage);
      }
    }); 
    $('#editsubjectdataproperty').click(function() {
      var errormessage = ' Please select some subject data property to edit.';
      
      if($('#selectsubjectlist > li.active').length) 
      {
        $('#updatesubjectdataproperty').show(); 
        $('#cancelsubjectdataproperty').show(); 
        $('#addsubjectdataproperty').hide(); 
        $('#subjectdataproperty').val($('#selectsubjectlist > li.active').html());
        
      }
      else
      {
        showError(errormessage);
      }
    }); 
    $('#updatesubjectdataproperty').click(function() {
      var listItem = $('#selectsubjectlist > li.active');
      var index = $( "#selectsubjectlist > li" ).index( listItem );
      errormessage = ' Please enter some data property for subject.';
      var txtvalue = $.trim($('#subjectdataproperty').val());
      if(txtvalue != '') 
      {
        $('#selectsubjectlist > li').eq(index).html(txtvalue);
        if($('#selectsubjectlist > li').eq(index).hasClass('active'))
        {
          $('#selectsubjectlist > li').eq(index).removeClass('active');
        }
        resetSelectSubject();
      }
      else
      {
        showError(errormessage);
      }
    });
    $('#cancelsubjectdataproperty').click(function() {
      resetSelectSubject();
    });

    // SELECT OBJECT
    function resetSelectObject()
    {
      $('#updateobjectdataproperty').hide(); 
      $('#cancelobjectdataproperty').hide(); 
      $('#addobjectdataproperty').show(); 
      $('#selectobjectlist > li.active').removeClass('active');
      $('#objectdataproperty').val('');
    }
    $('#addobjectdataproperty').click(function() {
      var errormessage = ' Please enter some data property for object.';
      var txtvalue = $.trim($('#objectdataproperty').val());
      if(txtvalue != '') 
      {
        $('#selectobjectlist').append('<li class="list-group-item">'+txtvalue+'</li>');
        $('#selectobjectlist > li').last().click(function() {
          if ($(this).hasClass("active")) 
          {
            $(this).removeClass('active');
          }
          else
          {
            $('#selectobjectlist > li').removeClass('active');
            $(this).addClass('active');
          }
        });
        $('#objectdataproperty').val('');
      }
      else
      {
        showError(errormessage);
      }
    }); 

    $('#updateobjectdataproperty').hide(); 
    $('#cancelobjectdataproperty').hide(); 

    $('#deleteobjectdataproperty').click(function() {
      var errormessage = ' Please select some object data property to delete.';
      if($('#selectobjectlist > li.active').length) 
      {
        $('#selectobjectlist > li.active').remove();
      }
      else
      {
        showError(errormessage);
      }
    }); 
    $('#editobjectdataproperty').click(function() {
      var errormessage = ' Please select some object data property to edit.';
      
      if($('#selectobjectlist > li.active').length) 
      {
        $('#updateobjectdataproperty').show(); 
        $('#cancelobjectdataproperty').show(); 
        $('#addobjectdataproperty').hide(); 
        $('#objectdataproperty').val($('#selectobjectlist > li.active').html());
        
      }
      else
      {
        showError(errormessage);
      }
    }); 
    $('#updateobjectdataproperty').click(function() {
      var listItem = $('#selectobjectlist > li.active');
      var index = $( "#selectobjectlist > li" ).index( listItem );
      errormessage = ' Please enter some data property for object.';
      var txtvalue = $.trim($('#objectdataproperty').val());
      if(txtvalue != '') 
      {
        $('#selectobjectlist > li').eq(index).html(txtvalue);
        if($('#selectobjectlist > li').eq(index).hasClass('active'))
        {
          $('#selectobjectlist > li').eq(index).removeClass('active');
        }
        resetSelectObject();
      }
      else
      {
        showError(errormessage);
      }
    });
    $('#cancelobjectdataproperty').click(function() {
      resetSelectObject();
    });
    $('#btnexecutequery').click(function(){
    	$('#btnexecutequery').prop('disabled',true);
    	$('#btnexecutequery').find('b').html('Loading results...');
      	var query = '';
	      var matchclause = '';
	      var returnclause = '';
	      var whereclause = '';
	
	      returnclause = 'Return DISTINCT ';
	      $('#selectsubjectlist > li').each(function( index ) {
	        returnclause = returnclause + 's.' + $(this).html() + ',';
	      });
	      $('#selectobjectlist > li').each(function( index ) {
	        returnclause = returnclause + 'o.' + $(this).html() + ',';
	      });
	      returnclause = returnclause.substring(0,returnclause.length-1);
	
	      matchclause = 'MATCH ';
	      if($('#neosubject-list-group > a').length > 0)
	      {
	        matchclause = matchclause + '(s)-[r1:IsA]->(cs),';
	      }
	      if($('#neoobject-list-group > a').length > 0)
	      {
	        matchclause = matchclause + '(o)-[r2:IsA]->(co),';
	      }
	      if(subIsNotA > 0)
	      {
	        matchclause = matchclause + '(s)-[r4:IsNotA]->(ncs),';
	      }
	      if(obIsNotA > 0)
	      {
	        matchclause = matchclause + '(o)-[r5:IsNotA]->(nco),';
	      }
	      if($('#preobjectpropertyiri').val() != '')
	      {
	        matchclause = matchclause + '(s)-[r3:'+$('#preobjectpropertyiri').val()+']->(o),';
	      }
	
	      matchclause = matchclause.substring(0,matchclause.length-1);
	
	      whereclause = 'Where ';
	
	      $('#neosubject-list-group > a').each(function( index ) {
	        whereclause = whereclause + ' ' + $(this).find('p').html();
	      });
	      $('#neoobject-list-group > a').each(function( index ) {
	        whereclause = whereclause + ' ' + $(this).find('p').html();
	      });
	      whereclause = whereclause.replace("Where  AND", "Where (1=1) AND"); 
	      whereclause = whereclause.replace("Where  OR", "Where (1=0) OR"); 
	
	      query = matchclause  + ' ' + whereclause + ' ' + returnclause;
	      
	      $.ajax({
	          type:'POST',
	          url: 'rest/UserService/executematchquery',
	          dataType:'text',
	          data: query,
	          contentType: 'text/plain',
	          xhrFields: {
	            withCredentials: false
	          },
	          success: function(data){
	              $('#tblresult').html(data);
	              $('#btnexecutequery').prop('disabled',false);
	              $('#btnexecutequery').find('b').html('Execute Query');
		          
	          },
	          error: function(error){
	              alert('error: ' + error);
	              $('#btnexecutequery').prop('disabled',false);
	              $('#btnexecutequery').find('b').html('Execute Query');
	          }
	      }); 
    });
      $("#file-upload").change(function(){
	      $('#owlfilepath').val($('#file-upload').val());
	  });
	  $('#uploadowlfile').click(function(){
		    $('#uploadowlfile').prop('disabled',true);
		    $('#uploadowlfile').find('b').html('Importing...');
		    var objFile = $("#file-upload");
		    var file = objFile[0].files[0];
		    $.ajax({
				url : "rest/UserService/uploadowlxml",
				type : "POST",
				contentType : "multipart/form-data",
				data: file,
				processData: false,
				success: function(data){
				      $('#uploadowlfile').prop('disabled',false);
				      $('#uploadowlfile').find('b').html('Import');
				      showSuccess("File imported successfully!!!");
				  },
				error: function(error){
				    $('#uploadowlfile').prop('disabled',false);
				    $('#uploadowlfile').find('b').html('Import');
				    showError("Error in uploading file!!!");
				}
		    }); 
		    
	  });
	  

  });
</script>
</body>
</body>
</html>
